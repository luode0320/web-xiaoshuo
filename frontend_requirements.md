# 小说阅读系统前端需求文档

## 项目概述

本项目前端部分是一个基于Vue.js的在线小说阅读系统，与Go后端API配合，
提供丰富的小说阅读体验。前端负责用户界面展示、交互逻辑处理和本地数据缓存。
系统仅支持中文。

## 项目结构

```
frontend/
├── src/
│   ├── components/       # 通用组件
│   ├── views/            # 页面组件
│   ├── assets/           # 静态资源
│   ├── router/           # 路由配置
│   ├── utils/            # 工具函数
│   └── App.vue
├── public/               # 静态资源目录
├── package.json
└── vite.config.js
```

## 技术栈

- Vue.js 3.x
- Vue Router
- Pinia（状态管理）
- Composition API
- Vite（构建工具）
- Element Plus/Naive UI（UI组件库）
- TypeScript（可选）
- Axios（HTTP请求）
- epub.js（处理EPUB格式）
- js-sha256（文件hash验证）

## 功能模块

### 1. 用户界面

#### 1.1 用户模块
- 用户注册：邮箱格式验证注册（使用第三方库vee-validate实现邮箱格式验证）
  - 注册时可选择填写昵称，若未填写则默认使用邮箱作为昵称
  - 使用第三方库validator.js进行邮箱格式验证

- 用户登录：邮箱和密码登录（使用第三方库vee-validate实现表单验证）
  - 使用JWT进行认证

- 个人中心：展示用户基本信息、上传历史、评论历史、评分历史

- 昵称管理：用户可在个人中心修改昵称，默认昵称为登录邮箱
  - 使用第三方库vee-validate实现表单验证

- 管理员模块：
  - 审核功能入口：管理员在个人中心页面会看到"审核管理"入口，点击进入审核页面
  - 审核页面功能：
    - 查看待审核小说列表，支持批量选择
    - 点击小说标题查看详情和阅读预览
    - 支持单个审核操作（通过/拒绝/退回修改）
    - 支持批量审核操作（批量通过/拒绝/退回修改）
    - 显示待审核小说数量统计
  - 用户管理功能：可查看用户列表、冻结/解冻用户、删除冻结用户的未审核小说
  - 使用is_admin字段标识管理员账户

- 关于我们页面：
  - 在个人中心页面添加"关于我们"入口
  - 页面内容：
    - 项目介绍和愿景
    - 开发团队信息
    - 联系方式
    - 外部链接：推特(Twitter)、Telegram群组等社交媒体链接
    - 使用条款和隐私政策链接
    - 版本信息和更新日志

- 冻结用户处理：被冻结用户登录后，界面会显示账户被冻结提示，
  上传、评论、评分、点赞等功能将被禁用，但仍可浏览和阅读已有内容。

- 用户内容管理：用户可在个人中心查看和管理自己上传的小说、
  发布的评论、提交的评分

- 系统消息：用户可在个人中心查看系统发送的通知消息，
  包括审核结果、账户状态变更等

#### 1.2 首页
- 顶部搜索框：按名称、作者、主角名称、小说字数等搜索小说
- 推荐小说列表：展示推荐小说（名称、logo图片）
- 无限滚动加载更多小说（使用第三方库vue-virtual-scroll-list实现）
- 调用后端接口查询推荐小说列表

#### 1.3 分类页
- 分类列表：展示各种小说分类
- 默认显示第一个分类的小说列表（名称、logo图片）
- 无限滚动加载更多小说（使用第三方库vue-virtual-scroll-list实现）
- 调用后端接口查询分类小说列表

#### 1.4 排行榜页
- 顶部时间范围选择：总榜、今日榜、本周榜、本月榜
- 排行榜列表：按点击量排序展示小说（名称、logo图片）
- 无限滚动加载更多小说（使用第三方库vue-virtual-scroll-list实现）
- 调用后端接口查询排行榜数据

#### 1.5 上传页
- 上传功能：支持单个或批量上传txt、epub格式文件
  - 普通用户每日上传限制为10本，管理员用户不受限制
  - 上传失败时根据错误类型显示具体提示
  - 必须登录用户才能上传

  - 上传频率限制：
    - 每个用户每日上传小说数量限制为10本，按自然日（00:00-23:59）计算
    - 管理员用户不受此限制
    - 频次上传超过限制时提示"今日上传次数已达上限，请明天再试"

- 文件hash验证：上传前计算文件hash防止重复上传（使用js-sha256库）
- 上传进度显示：批量上传时每上传一个进度条就前进，
  直到所有的都上传完成；如果是单个文件，进度条从0到100变化，
  上传成功后显示100的进度
- 审核状态：上传后小说处于审核中状态
- 小说列表：默认展示审核中和已通过的小说，
  上传列表返回上传用户的信息（包括昵称）
- 审核过滤：可选择是否过滤审核中的小说
- 无限滚动加载更多小说（使用第三方库vue-virtual-scroll-list实现）
- 上传状态反馈
- 删除小说功能（上传用户和管理员可以删除）

#### 1.6 底部导航栏
- 首页：推荐小说展示
- 分类：小说分类浏览
- 排行榜：阅读次数排行榜
- 上传：上传txt、epub格式小说
- 用户：用户个人中心、注册登录入口（未登录显示登录注册，
  已登录显示个人中心）

#### 1.7 小说详情页
- 小说基本信息展示
- 小说封面显示
- 作者信息展示
- 小说字数统计
- 小说分类展示
- 小说关键词展示
- 小说简介（部分展示）
- 评分和评论统计
- 章节目录（通过解析小说文件自动生成和上传时提供，
  用户可点击目录项跳转到对应章节，当前阅读位置高亮显示，
  使用epub.js等库实现）
- 快速开始阅读按钮（点击右侧区域进入第一页，
  当用户对当前小说的阅读进度低于10%时记录阅读次数，
  从服务器获取并恢复用户上次阅读进度）。
  阅读进度会自动同步到服务器，支持跨设备同步。
- 点击简介可打开详细简介弹窗（居中显示，可右上角关闭）
- 点击评论可打开评论列表弹窗（居中显示，可右上角关闭，
  支持滚动分页，默认每页显示5条评论，支持按点赞最多和最新排序，
  点赞最多为默认排序）
- 相关小说推荐
- 删除小说功能（仅上传用户和管理员可见）

#### 1.8 阅读页面
- 仿起点中文网的阅读界面
- 支持分页/滚动阅读模式切换（使用epub.js或类似阅读器库实现）
- 个性化设置（字体、背景、间距）

  - 个性化阅读设置：
    - 字体大小（范围[12-100px]，提供常用选项）
    - 字体类型（宋体、黑体、楷体、仿宋等标准Web字体）
    - 背景颜色（白、黑、灰、护眼绿等，提供预设主题）
    - 行间距（1.0-2.5倍，预设常用选项）
    - 阅读模式：
      - 滚动模式：连续滚动阅读，适合长篇内容
      - 翻页模式：模拟纸质书翻页效果
    - 夜间模式：
      - 手动切换：用户可手动开启/关闭夜间模式
      - 护眼模式：提供护眼主题
      - 记忆功能：记住用户当前使用的主题模式，
        在下次访问时自动应用
    - 阅读位置记忆：记住用户当前阅读位置，包括章节和页码

- 目录导航（通过解析小说文件自动生成和上传时提供，
  用户可点击目录项跳转到对应章节，当前阅读位置高亮显示）
- 上一章/下一章导航
- 点击阅读内容区域左侧30%实现上一页，点击右侧30%实现下页，
  支持覆盖翻页效果（使用第三方库实现翻页动画和流畅滚动）
- 阅读模式选择（滚动模式和翻页模式，通过第三方库实现）
- 在进入小说第一章（即开始阅读）时调用接口记录点击量
- 自动保存阅读进度到服务器（通过阅读进度接口），
  使用防抖机制，每30秒或翻页时更新一次

  - 阅读统计功能：
    - 记录阅读时长：
      - 统计规则：仅在页面可见且用户有交互时统计，
        暂停超过30秒则暂停计时
      - 实现方式：使用第三方库moment.js或dayjs计算阅读时间
      - 活跃度判断：结合鼠标移动、键盘输入等事件判断用户是否在阅读
      - 统计精度：精确到分钟

- 在小说最后一页显示分类和关键词设置功能（必须登录用户且
  阅读进度按照字数位置的百分比达到20%以上时显示）
- 显示当前已设置的分类和关键词，避免重复设置
- 提交分类和关键词到后端接口（需要用户认证）
- 通过第三方库判断当前是否是每一章的最后一页，
  在该页面可以对小说的这一章节进行评论
- 章节目录（通过解析小说文件自动生成和上传时提供，
  第三方库如epub.js或txt解析库支持，用户可点击目录项
  跳转到对应章节，当前阅读位置高亮显示）
- 章节评论弹窗显示这一章的评论分页数据(点赞最多排序展示)
- 用户可以在弹窗的最下方一个输入框输入提交评论
- 评论的分页机制也是向下滚动刷新（使用第三方库vue-virtual-scroll-list实现）
- 支持在弹窗中对评论进行评论，使用第三方库vue3-tree-chart
  实现一级回复功能，不支持多层级嵌套回复
- 每个用户对同一章节的评论数量限制为5条，评论内容通过
  前端基本验证后提交（使用第三方库vee-validate实现字符
  长度限制、内容过滤等验证，评论内容最多500字符）。
  使用DOMPurify库对用户输入进行XSS过滤

  - 解析失败处理：
    - 如果解析失败，系统会显示错误信息并提供原始文件下载链接
    - 解析失败的小说在阅读页面显示提示：
      "该小说文件解析失败，您可以选择下载原始文件"
    - 提供下载按钮供用户下载原始文件
    - 无法在在线阅读器中查看内容
    - 使用第三方库DOMPurify进行内容安全过滤

### 2. 核心功能

#### 2.1 搜索功能
- 全局搜索框
- 小说标题、作者搜索
- 搜索结果高亮显示
- 搜索历史记录

  - 搜索增强功能：
    - 高级搜索：
      - 多条件组合搜索（使用第三方库fuse.js实现模糊搜索，
        匹配度阈值设定为0.6）
      - 搜索结果排序：按匹配度、点击量、评分综合排序
    - 搜索历史：
      - 保存用户搜索历史（最多保存20条记录）
    - 热门搜索：
      - 热门词来源：基于近期的搜索数据统计
      - 更新频率：每小时更新一次
      - 展示数量：最多展示10个热门关键词
    - 搜索建议：
      - 触发机制：用户输入时延迟300ms触发
      - 建议数量：最多显示5条建议
      - 数据来源：结合搜索历史和热门搜索提供智能建议

#### 2.2 个性化设置
- 字体大小调整（范围[12-100px]）
- 背景色/主题切换（白、黑、灰三种选项）

#### 2.3 阅读进度管理
- 自动保存阅读进度到本地存储（使用第三方库
  pinia-plugin-persistedstate实现）
- 按照字数位置的百分比存储和展示进度
- 显示阅读百分比
- 跳转到上次阅读位置继续阅读
- 阅读时长统计

  - 跨设备同步机制：
    - 本地存储数据仅在当前设备和浏览器中有效
    - 服务器存储支持跨设备同步
    - 同步策略：当用户在多个设备上同时阅读时，
      以最新的阅读进度为准进行同步
    - 时间戳精度：使用毫秒级时间戳进行精确比较
    - 进度精度：百分比保留两位小数（如85.25%）
    - 同步失败时的处理：
      - 本地缓存进度：使用第三方库pinia-plugin-persistedstate
        进行本地缓存
      - 重试机制：使用第三方库axios实现重试机制

#### 2.4 本地缓存策略
- 小说内容本地缓存
- 用户设置本地存储
- 阅读历史本地缓存
- 离线内容缓存

### 3. 社交功能

#### 3.1 评论系统
- 章节评论展示
- 发布评论（必须登录用户才能发布）
- 评论回复
- 评论点赞（必须登录用户才能点赞）
- 评论排序（最新、最热）

      - 评论管理：
        - 评论排序：
          - 按时间排序：最新评论优先或最旧评论优先
          - 按点赞数排序：点赞数高的评论优先
        - 评论限制：
          - 同章节评论数：每个用户对同一章节的评论数量限制为5条
          - 评论长度：评论内容最多500字符
          - 评论频率：同一用户连续评论间隔不少于30秒
        - 评论互动：
          - 评论回复：支持对评论进行回复，形成评论线程
          - 评论点赞：用户可以对评论进行点赞，但不能重复点赞

  - 评论删除权限：
    - 普通用户：只能删除自己发布的评论
    - 管理员：可以删除任何用户的评论

#### 3.2 评分系统
- 为小说打分（必须登录用户才能评分）
- 提交评分说明（对小说的评论）
- 查看平均评分
- 查看小说评分列表（包含评分、评分说明、点赞数）
- 对评分进行点赞（必须登录用户才能点赞）
- 防重复评分机制

  - 评分统计：
    - 实时计算平均分
    - 评分分布统计（各星级评分数量及占比）
    - 简单的异常评分检测：对短时间内大量评分进行基础检测

  - 评分删除权限：
    - 普通用户：只能删除自己发布的评分
    - 管理员：可以删除任何用户的评分

### 4. 数据管理

#### 4.1 API交互
- 与后端API通信（使用Axios库）
- 错误处理和重试机制
- 请求拦截和响应拦截（包含用户认证token）
- 文件上传功能（支持txt、epub格式）
- 使用epub.js库处理EPUB格式文件
- 使用DOMPurify库进行内容安全处理
- 本地数据持久化（使用浏览器localStorage/sessionStorage或vuex-persist库）
- 用户认证状态管理（使用JWT token）

### 5. 性能优化

#### 5.1 渲染优化
- 虚拟滚动（处理长文本，使用vue-virtual-scroller或vue-virtual-scroll-list库）
- 内容懒加载
- 图片懒加载
- 组件按需加载
- 翻页内容预加载
- 点击区域事件优化
- EPUB内容渲染优化（使用epub.js库）

#### 5.2 网络优化
- API请求缓存
- 请求合并
- 数据压缩

#### 5.3 内存优化
- 内存泄漏防范
- 组件销毁清理
- 定时器清理

### 6. 用户体验

#### 6.1 响应式设计
- 适配桌面端、平板、手机
- 不同屏幕尺寸下的阅读体验优化
- 横屏/竖屏自适应

#### 6.2 交互体验
- 平滑滚动
- 快速加载动画
- 操作反馈
- 错误处理和友好的错误提示
- 阅读页面点击翻页交互
- 阅读模式切换体验

  - 用户体验增强：
    - 页面加载：
      - 骨架屏或加载动画（使用第三方库vue-content-loading实现骨架屏）
      - 预加载热门小说内容以提升用户体验
      - 渐进式加载（使用第三方库vue-lazyload实现图片懒加载）
    - 操作反馈：
      - 成功/失败提示（使用第三方库element-plus的Notification组件）
      - 操作确认对话框（防止误操作）
      - 进度指示（上传、下载等长时间操作的进度显示）
    - 错误处理：
      - 友好的错误提示（使用第三方库vue-toastification显示错误信息）
      - 错误上报机制（使用第三方库sentry捕获并上报错误）
      - 网络异常处理（离线模式支持和重试机制）

#### 6.3 无障碍访问
- 语义化HTML
- 键盘导航支持
- 屏幕阅读器兼容
- 高对比度模式支持

### 7. 安全性

#### 7.1 XSS防护
- 用户输入内容过滤
- 富文本内容安全处理

#### 7.2 认证安全
- Token安全存储
- 自动过期处理

### 8. 构建和部署

#### 8.1 构建配置
- Vite配置
- 环境变量管理
- 代码分割策略

#### 8.2 部署配置
- 静态文件部署
- API接口配置
- CDN配置

## 第三方库使用

- Vue.js 3.x: 前端框架
- Vue Router: 路由管理
- Pinia: 状态管理
- Element Plus/Naive UI: UI组件库
- Axios: HTTP请求
- epub.js: EPUB格式处理
- js-sha256: 文件hash计算
- pinia-plugin-persistedstate: 本地存储持久化
- vee-validate: 表单验证
- DOMPurify: 内容安全处理
- moment.js或dayjs: 时间处理
- fuse.js: 模糊搜索
- vue3-tree-chart: 评论树形结构
- vue-content-loading: 骨架屏加载
- vue-lazyload: 图片懒加载
- vue-toastification: 错误提示
- vue-virtual-scroll-list: 无限滚动加载和虚拟滚动
- core-js: JavaScript兼容性
- normalize.css: CSS重置
- nprogress: 页面加载进度条
- crypto-js: 加密算法支持

## 组件设计

### 1. 基础组件
- 按钮组件
- 输入框组件
- 卡片组件
- 弹窗组件
- 加载组件

### 2. 业务组件
- 小说卡片组件
- 阅读器组件（支持txt和epub格式，使用epub.js等第三方库实现）
- 目录组件（使用第三方库实现章节导航）
- 评论组件（使用第三方库实现评论功能）
- 评分组件（支持评分、评分说明输入）
- 评分列表组件（展示评分、评分说明、点赞数）
- 评分点赞组件（对评分进行点赞）
- 搜索组件
- 翻页组件（支持点击翻页和滚动翻页，使用第三方库实现）
- 文件上传组件（支持txt、epub格式，使用第三方库实现）
- 无限滚动组件（实现滚动加载更多功能，使用第三方库）
- 底部导航栏组件
- 排行榜组件
- 分类选择组件（用于为小说选择分类）
- 关键词输入组件（用于为小说添加关键词）
- 小说分类设置组件（显示当前分类和关键词，允许用户设置）
- 进度条组件（显示上传进度，使用第三方库实现）
- 本地存储组件（管理阅读进度等本地数据，使用浏览器API或vuex-persist）
- 用户注册组件（邮箱注册表单，使用第三方库vee-validate验证）
- 用户登录组件（邮箱登录表单，使用第三方库vee-validate验证）
- 个人中心组件（展示用户信息和操作历史）
- 用户认证组件（管理JWT token和用户状态）
- 阅读进度组件（管理用户阅读进度，自动保存到服务器）
- 阅读历史组件（展示用户阅读历史记录）
- 用户内容管理组件（管理用户上传的小说、发布的评论、提交的评分）
- 小说管理组件（管理用户上传的小说，包括编辑、删除功能）
- 评论管理组件（管理用户发布的评论，包括编辑、删除功能）
- 评分管理组件（管理用户提交的评分，包括编辑、删除功能）
- 管理员用户管理组件（管理员查看和管理用户，包括冻结/解冻功能）
- 管理员内容管理组件（管理员管理用户内容，包括一键删除未审核小说功能）
- 管理员审核组件：
  - 审核列表组件：显示待审核小说列表，支持批量选择
  - 审核详情组件：显示小说详情和预览功能
  - 审核操作组件：单个审核操作（通过/拒绝/退回修改）
  - 批量审核组件：批量操作工具栏和确认对话框
  - 审核统计组件：显示待审核数量统计
- 系统消息组件（展示系统消息，包括审核结果、账户状态变更等通知）
- 关于我们组件：
  - 项目介绍展示组件
  - 社交媒体链接组件（推特、Telegram等）
  - 法律信息组件（使用条款、隐私政策）
  - 版本信息组件（版本号、更新日志）

### 3. 布局组件
- 头部导航
- 侧边栏
- 页脚
- 响应式布局

## API接口约定

### 1. 请求规范
- 使用Axios进行HTTP请求
- 统一的请求头设置
- Token自动添加

### 2. 响应处理
- 统一的响应格式处理
- 错误码处理
- 加载状态管理

### 3. 拦截器
- 请求拦截器（添加认证头等）
- 响应拦截器（错误处理、数据转换）

### 4. API响应数据结构
- 小说详情响应应包含字数统计字段
- 阅读页面需要支持翻页操作的API调用
- 上传接口支持文件和文件名一起上传

### 5. 第三方库集成
- 集成EPUB处理库（如epub.js）来处理epub格式
- 集成虚拟滚动库（如vue-virtual-scroll-list）优化长文本渲染
- 集成无限滚动库（如vue-infinite-loading）实现滚动加载更多功能
- 集成本地存储库（如vuex-persist）管理用户个性化设置
- 集成文件上传库（如vue-upload-component）处理文件上传
- 集成文本过滤库（如DOMPurify）进行内容安全处理
- 集成分页库处理无限滚动和分页请求

### 6. 特殊功能API
- 记录小说点击量：在进入小说第一章（即开始阅读）时调用后端接口记录点击量
- 排行榜接口：支持按时间范围查询排行榜数据
- 搜索接口：支持按名称、作者、主角名称、小说字数等条件搜索
- 评分接口：支持提交评分和评分说明（最多250个字符，非必填）
- 评分列表接口：获取小说的评分列表（包含评分、评分说明、点赞数、用户信息如昵称）
- 评分点赞接口：对指定评分进行点赞（需要用户登录）
- 小说分类和关键词接口：提交小说的分类和关键词（需要用户登录且阅读进度达到20%以上）
- 搜索接口扩展：支持按分类ID和关键词搜索小说
- 章节评论接口：获取和提交小说章节评论，支持对评论进行评论
- 点赞状态管理：点赞状态通过用户ID关联服务器数据
- 用户注册登录接口：支持邮箱注册和登录
- 用户信息管理接口：支持获取和更新用户信息（如昵称）
- 小说上传接口：必须登录用户才能上传小说
- 上传小说列表接口：返回上传用户的信息（包括昵称）
- 阅读进度接口：支持保存和获取用户阅读进度
- 用户阅读历史接口：获取用户的阅读历史记录
- 用户内容管理接口：支持获取和管理用户上传的小说、评论、评分
- 小说删除接口：支持删除小说（上传用户和管理员）
- 评论删除接口：支持删除评论（评论发布用户）
- 评分删除接口：支持删除评分（评分发布用户）
- 管理员用户管理接口：支持获取用户列表、冻结/解冻用户
- 管理员内容管理接口：支持删除冻结用户的未审核小说
- 批量审核接口：支持管理员批量审核小说（批量通过、批量拒绝、批量退回修改）
- 系统消息接口：支持获取和管理用户系统消息
- 审核通知接口：当小说审核状态变更时通知上传用户

## 状态管理设计

### 1. 状态管理架构
- 使用Pinia作为状态管理库
- 模块化设计：按功能模块划分store
- 响应式状态：使用Vue 3的响应式系统
- 类型安全：使用TypeScript确保类型安全

### 2. Store模块划分

#### 2.1 用户模块 (userStore)
- 状态：
  - `userInfo`: 用户信息（id, email, nickname, is_admin, is_active等）
  - `token`: JWT认证token
  - `isAuthenticated`: 认证状态
  - `loginError`: 登录错误信息
  - `registerError`: 注册错误信息
- 操作：
  - `login(email, password)`: 用户登录
  - `logout()`: 用户登出
  - `register(email, password, nickname)`: 用户注册
  - `updateProfile(nickname)`: 更新用户信息
  - `checkAuth()`: 检查认证状态
- Getter：
  - `isAdmin`: 是否为管理员
  - `isActive`: 用户是否活跃（未被冻结）
  - `userNickname`: 获取用户昵称（优先使用昵称，否则使用邮箱）

#### 2.2 小说模块 (novelStore)
- 状态：
  - `novelList`: 小说列表数据
  - `currentNovel`: 当前查看的小说详情
  - `pagination`: 分页信息（当前页、总页数、每页数量）
  - `loading`: 加载状态
  - `error`: 错误信息
- 操作：
  - `fetchNovels(params)`: 获取小说列表
  - `fetchNovelById(id)`: 根据ID获取小说详情
  - `searchNovels(keyword, filters)`: 搜索小说
  - `uploadNovel(file, metadata)`: 上传小说
  - `deleteNovel(id)`: 删除小说
- Getter：
  - `filteredNovels`: 过滤后的小说列表
  - `novelCount`: 小说总数
  - `hasMore`: 是否还有更多数据可加载

#### 2.3 阅读模块 (readingStore)
- 状态：
  - `readingProgress`: 阅读进度映射（novelId -> progress）
  - `readingHistory`: 阅读历史记录
  - `readingSettings`: 阅读设置（字体、主题、间距等）
  - `currentReading`: 当前正在阅读的小说信息
- 操作：
  - `saveProgress(novelId, progress, chapterId)`: 保存阅读进度
  - `getProgress(novelId)`: 获取阅读进度
  - `updateSettings(settings)`: 更新阅读设置
  - `addToHistory(novel)`: 添加到阅读历史
  - `clearHistory()`: 清空阅读历史
- Getter：
  - `recentHistory`: 最近阅读记录
  - `readingStats`: 阅读统计信息
  - `currentSettings`: 当前阅读设置

#### 2.4 UI模块 (uiStore)
- 状态：
  - `theme`: 当前主题（light/dark）
  - `sidebarCollapsed`: 侧边栏是否折叠
  - `loading`: 全局加载状态
  - `notifications`: 通知消息列表
  - `modal`: 当前打开的弹窗
- 操作：
  - `toggleTheme()`: 切换主题
  - `toggleSidebar()`: 切换侧边栏
  - `showLoading()`: 显示加载状态
  - `hideLoading()`: 隐藏加载状态
  - `addNotification(message, type)`: 添加通知
  - `removeNotification(id)`: 移除通知
  - `openModal(component, props)`: 打开弹窗
  - `closeModal()`: 关闭弹窗

#### 2.5 分类模块 (categoryStore)
- 状态：
  - `categories`: 分类列表
  - `currentCategory`: 当前选中的分类
  - `categoryNovels`: 当前分类下的小说列表
- 操作：
  - `fetchCategories()`: 获取分类列表
  - `selectCategory(id)`: 选择分类
  - `fetchNovelsByCategory(id, params)`: 获取分类下的小说
- Getter：
  - `categoryOptions`: 分类选项（用于下拉选择）
  - `categoryCount`: 分类数量

#### 2.6 排行榜模块 (rankingStore)
- 状态：
  - `rankings`: 排行榜数据
  - `rankingType`: 当前排行榜类型（total/today/week/month）
  - `rankingTimeRange`: 时间范围选择
- 操作：
  - `fetchRankings(type, params)`: 获取排行榜数据
  - `changeRankingType(type)`: 切换排行榜类型
  - `updateTimeRange(range)`: 更新时间范围
- Getter：
  - `currentRankings`: 当前排行榜数据
  - `rankingTitle`: 排行榜标题

#### 2.7 评论模块 (commentStore)
- 状态：
  - `comments`: 评论列表
  - `currentComment`: 当前编辑的评论
  - `commentPagination`: 评论分页信息
- 操作：
  - `fetchComments(novelId, chapterId, params)`: 获取评论列表
  - `addComment(comment)`: 添加评论
  - `updateComment(id, content)`: 更新评论
  - `deleteComment(id)`: 删除评论
  - `likeComment(id)`: 点赞评论
- Getter：
  - `sortedComments`: 排序后的评论列表
  - `commentCount`: 评论总数

#### 2.8 评分模块 (ratingStore)
- 状态：
  - `ratings`: 评分列表
  - `userRating`: 用户对当前小说的评分
  - `averageRating`: 平均评分
- 操作：
  - `fetchRatings(novelId, params)`: 获取评分列表
  - `addRating(rating)`: 添加评分
  - `updateRating(id, rating)`: 更新评分
  - `deleteRating(id)`: 删除评分
  - `likeRating(id)`: 点赞评分
- Getter：
  - `ratingStats`: 评分统计信息
  - `ratingDistribution`: 评分分布

#### 2.9 审核模块 (reviewStore)
- 状态：
  - `pendingNovels`: 待审核小说列表
  - `selectedNovels`: 已选中的小说ID集合（用于批量操作）
  - `currentReviewNovel`: 当前正在审核的小说详情
  - `reviewStats`: 审核统计信息（待审核数量、今日审核数量等）
  - `reviewLoading`: 审核相关加载状态
  - `reviewError`: 审核错误信息
- 操作：
  - `fetchPendingNovels(params)`: 获取待审核小说列表
  - `selectNovel(id)`: 选择/取消选择小说（用于批量操作）
  - `selectAllNovels()`: 选择所有小说
  - `clearSelection()`: 清空选择
  - `fetchNovelForReview(id)`: 获取小说详情用于审核
  - `approveNovel(id, reason)`: 审核通过单个小说
  - `rejectNovel(id, reason)`: 审核拒绝单个小说
  - `returnNovel(id, feedback)`: 退回修改单个小说
  - `batchApproveNovels(ids, reason)`: 批量审核通过
  - `batchRejectNovels(ids, reason)`: 批量审核拒绝
  - `batchReturnNovels(ids, feedback)`: 批量退回修改
  - `fetchReviewStats()`: 获取审核统计信息
- Getter：
  - `selectedCount`: 已选中的小说数量
  - `hasSelection`: 是否有选中的小说
  - `filteredPendingNovels`: 过滤后的待审核小说列表
  - `reviewProgress`: 审核进度统计

### 3. 数据流设计

#### 3.1 单向数据流
```
组件触发Action → Store处理逻辑 → 更新State → 组件重新渲染
```

#### 3.2 异步操作处理
- 使用async/await处理异步API调用
- 统一错误处理机制
- 加载状态管理
- 请求取消机制

#### 3.3 状态更新策略
- 乐观更新：对于用户操作（如点赞、评论），先更新本地状态，再发送请求
- 悲观更新：对于重要操作（如支付、删除），先发送请求，成功后再更新状态
- 批量更新：对于频繁操作（如阅读进度），使用防抖批量更新

### 4. 状态持久化

#### 4.1 本地存储策略
- 使用pinia-plugin-persistedstate插件
- 持久化数据：
  - 用户认证信息（token）
  - 阅读进度和设置
  - UI主题偏好
  - 搜索历史
- 存储方式：
  - `localStorage`：长期存储（用户设置、阅读进度）
  - `sessionStorage`：会话存储（临时数据）
  - `IndexedDB`：大量数据存储（阅读历史、缓存数据）

#### 4.2 数据同步机制
- 服务器同步：重要数据（阅读进度）定期同步到服务器
- 冲突解决：使用时间戳解决数据冲突（以最新数据为准）
- 离线支持：本地缓存支持离线阅读
- 同步状态：显示数据同步状态和进度

### 5. 状态共享和通信

#### 5.1 组件间通信
- Props/Events：父子组件通信
- Provide/Inject：跨层级组件通信
- Event Bus：全局事件通信（使用mitt库）
- Store：复杂状态共享

#### 5.2 Store间通信
- 组合Store：一个Store可以导入和使用其他Store
- 共享状态：通过rootState访问其他模块的状态
- 动作协调：跨模块的动作协调

### 6. 性能优化

#### 6.1 状态分割
- 按功能模块分割状态，减少不必要的重新渲染
- 使用计算属性缓存计算结果
- 使用watchEffect处理副作用

#### 6.2 内存管理
- 及时清理不再使用的状态
- 使用弱引用存储大型数据
- 实现垃圾回收机制

#### 6.3 状态快照
- 支持状态快照和恢复
- 开发工具集成（Vue DevTools）
- 状态调试和监控

### 7. 错误处理

#### 7.1 状态错误处理
- 统一错误状态管理
- 错误边界组件
- 错误恢复机制

#### 7.2 网络错误处理
- 请求重试机制
- 离线状态检测
- 数据同步恢复

## 路由设计

### 1. 路由结构
- 首页 (/)
- 分类页 (/categories)
- 排行榜 (/rankings)
- 上传页 (/upload)
- 小说列表 (/novels)
- 小说详情 (/novels/:id)
- 阅读页面 (/novels/:id/read)
- 搜索页面 (/search)

### 2. 路由守卫
- 认证守卫
- 权限守卫
- 数据预加载

## 后续扩展功能

### 1. 社交功能扩展
- 用户关注系统
- 更复杂的评论互动（多层级评论）
- 个性化推荐算法

### 2. 高级阅读功能
- 自定义主题和布局
- 高级阅读统计
- 书签和笔记功能

### 3. 高级管理功能
- 数据分析和报表
- 用户行为分析
- 高级审核工具