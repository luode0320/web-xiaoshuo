# 小说阅读系统前端需求文档

## 项目概述

本项目前端部分是一个基于Vue.js的在线小说阅读系统，与Go后端API配合，提供丰富的小说阅读体验。前端负责用户界面展示、交互逻辑处理和本地数据缓存。系统仅支持中文。

## 项目结构

```
frontend/
├── src/
│   ├── components/       # 通用组件
│   ├── views/            # 页面组件
│   ├── assets/           # 静态资源
│   ├── router/           # 路由配置
│   ├── utils/            # 工具函数
│   └── App.vue
├── public/               # 静态资源目录
├── package.json
└── vite.config.js
```

## 技术栈

- Vue.js 3.x
- Vue Router
- Pinia（状态管理）
- Composition API
- Vite（构建工具）
- Element Plus/Naive UI（UI组件库）
- TypeScript（可选）
- Axios（HTTP请求）
- epub.js（处理EPUB格式）
- vue-virtual-scroll-list（虚拟滚动）
- vue-infinite-loading（无限滚动）
- vue-i18n（国际化，可选）
- js-sha256（文件hash验证）
- vuedraggable（拖拽功能）
- vue-meta（SEO优化）
- core-js（兼容性）
- regenerator-runtime（兼容性）

## 功能模块

### 1. 用户界面

#### 1.1 用户模块
- 用户注册：邮箱格式验证注册（使用第三方库如vee-validate实现邮箱格式验证），注册时可选择填写昵称，若未填写则默认使用邮箱作为昵称
- 用户登录：邮箱和密码登录（使用第三方库如vee-validate实现表单验证）
- 个人中心：展示用户基本信息、上传历史、评论历史、评分历史
- 昵称管理：用户可在个人中心修改昵称，默认昵称为登录邮箱（使用第三方库如vee-validate实现表单验证）

#### 1.2 首页
- 顶部搜索框：按名称、作者、主角名称、小说字数等搜索小说
- 推荐小说列表：展示推荐小说（名称、logo图片）
- 无限滚动加载更多小说（使用vue-infinite-loading等第三方库实现，每页加载10条数据，滚动到距离底部20%时开始加载下一页，当数据加载完毕后显示"已加载全部内容"提示）
- 调用后端接口查询推荐小说列表

#### 1.3 分类页
- 分类列表：展示各种小说分类
- 默认显示第一个分类的小说列表（名称、logo图片）
- 无限滚动加载更多小说（使用vue-infinite-loading等第三方库实现，每页加载10条数据，滚动到距离底部20%时开始加载下一页，当数据加载完毕后显示"已加载全部内容"提示）
- 调用后端接口查询分类小说列表

#### 1.4 排行榜页
- 顶部时间范围选择：总榜、今日榜、本周榜、本月榜
- 排行榜列表：按点击量排序展示小说（名称、logo图片）
- 无限滚动加载更多小说（使用vue-infinite-loading等第三方库实现，每页加载10条数据，滚动到距离底部20%时开始加载下一页，当数据加载完毕后显示"已加载全部内容"提示）
- 调用后端接口查询排行榜数据

#### 1.5 上传页
- 上传功能：支持单个或批量上传txt、epub格式文件（使用vue-upload-component等第三方库实现），必须登录用户才能上传
- 文件hash验证：上传前计算文件hash防止重复上传
- 上传进度显示：批量上传时每上传一个进度条就前进，直到所有的都上传完成；如果是单个文件，进度条从0到100变化，上传成功后显示100的进度。上传成功后等待后端完成文件解析（如字数统计、章节提取等）后再刷新列表（使用第三方库如vue-request或useRequest实现）
- 审核状态：上传后小说处于审核中状态
- 小说列表：默认展示审核中和已通过的小说，上传列表返回上传用户的信息（包括昵称）
- 审核过滤：可选择是否过滤审核中的小说
- 无限滚动加载更多小说（使用vue-infinite-loading等第三方库实现，每页加载10条数据，滚动到距离底部20%时开始加载下一页，当数据加载完毕后显示"已加载全部内容"提示）
- 上传状态反馈

#### 1.6 底部导航栏
- 首页：推荐小说展示
- 分类：小说分类浏览
- 排行榜：阅读次数排行榜
- 上传：上传txt、epub格式小说
- 用户：用户个人中心、注册登录入口（未登录显示登录注册，已登录显示个人中心）

#### 1.7 小说详情页
- 小说基本信息展示
- 小说封面显示
- 作者信息展示
- 小说字数统计
- 小说分类展示
- 小说关键词展示
- 小说简介（部分展示）
- 评分和评论统计
- 章节目录（通过解析小说文件自动生成和上传时提供，第三方库支持，用户可点击目录项跳转到对应章节，当前阅读位置高亮显示，使用epub.js等库实现）
- 快速开始阅读按钮（点击右侧区域进入第一页，当用户对当前小说的阅读进度低于10%时记录阅读次数，恢复直接跳转到上次进度，使用第三方库管理阅读进度）
- 点击简介可打开详细简介弹窗（居中显示，可右上角关闭）
- 点击评论可打开评论列表弹窗（居中显示，可右上角关闭，支持滚动分页，默认每页显示5条评论，支持按点赞最多和最新排序，点赞最多为默认排序，当数据加载完毕后显示"已加载全部内容"提示，使用vue-infinite-loading等库实现）
- 相关小说推荐（推荐拥有相同分类或者关键字的小说，按照阅读量排序的最多3本小说作为推荐，排除已读小说，向下滚动即可看到）

#### 1.8 阅读页面
- 仿起点中文网的阅读界面
- 支持分页/滚动阅读模式切换（使用epub.js或类似阅读器库实现）
- 个性化设置（字体、背景、间距）
- 目录导航（通过解析小说文件自动生成和上传时提供，第三方库支持，用户可点击目录项跳转到对应章节，当前阅读位置高亮显示）
- 上一章/下一章导航

- 亮度调节
- 夜间模式
- 点击阅读内容区域左侧30%实现上一页，点击右侧30%实现下一页，支持覆盖翻页效果（使用第三方库实现翻页动画和流畅滚动）
- 阅读模式选择（滚动模式和翻页模式，通过第三方库实现）
- 在进入小说第一章（即开始阅读）时调用接口记录点击量
- 在小说最后一页显示分类和关键词设置功能（当本地存储阅读进度按照字数位置的百分比达到20%以上时显示）
- 显示当前已设置的分类和关键词，避免重复设置
- 提交分类和关键词到后端接口
- 通过第三方库判断当前是否是每一章的最后一页，在该页面可以对小说的这一章节进行评论
- 章节评论弹窗显示这一章的评论分页数据(点赞最多排序展示)
- 用户可以在弹窗的最下方一个输入框输入提交评论
- 评论的分页机制也是向下滚动刷新（使用第三方库实现，每页加载10条数据，滚动到距离底部20%时开始加载下一页，当数据加载完毕后显示"已加载全部内容"提示）
- 支持在弹窗中对评论进行评论，使用第三方库如vue3-tree-chart或comment-box-vue实现一级回复功能，不支持多层级嵌套回复
- 每个用户对同一章节的评论数量限制为5条，评论内容通过前端基本验证后提交（使用第三方库如vee-validate实现字符长度限制、内容过滤等验证，评论内容最多500字符，不允许包含HTML标签）。使用DOMPurify库对用户输入进行XSS过滤

### 2. 核心功能

#### 2.1 搜索功能
- 全局搜索框
- 小说标题、作者搜索
- 搜索结果高亮显示
- 搜索历史记录

#### 2.2 个性化设置
- 字体大小调整（范围[12-100px]）
- 背景色/主题切换（白、黑、灰三种选项）



#### 2.4 阅读进度管理
- 自动保存阅读进度到本地存储（使用第三方库如pinia-plugin-persistedstate实现），按照字数位置的百分比存储和展示进度（使用第三方库如lodash.debounce实现防抖，每30秒或翻页时更新一次，最小更新间隔10秒）。本地存储数据仅在当前设备和浏览器中有效，不支持跨设备同步
- 显示阅读百分比
- 跳转到上次阅读位置继续阅读
- 阅读时长统计

#### 2.5 本地缓存策略
- 小说内容本地缓存
- 用户设置本地存储
- 阅读历史本地缓存
- 离线内容缓存

### 3. 社交功能

#### 3.1 评论系统
- 章节评论展示
- 发布评论（匿名或指定用户名）
- 评论回复
- 评论点赞
- 评论排序（最新、最热）

#### 3.2 评分系统
- 为小说打分
- 提交评分说明（对小说的评论）
- 查看平均评分
- 查看小说评分列表（包含评分、评分说明、点赞数）
- 对评分进行点赞
- 防重复评分机制



### 4. 数据管理

#### 4.1 API交互
- 与后端API通信（使用Axios库）
- 错误处理和重试机制
- 请求拦截和响应拦截（包含用户认证token）
- 文件上传功能（支持txt、epub格式）
- 使用epub.js库处理EPUB格式文件
- 使用DOMPurify库进行内容安全处理
- 本地数据持久化（使用浏览器localStorage/sessionStorage或vuex-persist库）
- 用户认证状态管理（使用JWT token）

### 6. 性能优化

#### 6.1 渲染优化
- 虚拟滚动（处理长文本，使用vue-virtual-scroller或vue-virtual-scroll-list库）
- 内容懒加载
- 图片懒加载
- 组件按需加载
- 翻页内容预加载
- 点击区域事件优化
- EPUB内容渲染优化（使用epub.js库）

#### 6.2 网络优化
- API请求缓存
- 请求合并
- 数据压缩

#### 6.3 内存优化
- 内存泄漏防范
- 组件销毁清理
- 定时器清理

### 7. 用户体验

#### 7.1 响应式设计
- 适配桌面端、平板、手机
- 不同屏幕尺寸下的阅读体验优化
- 横屏/竖屏自适应

#### 7.2 交互体验
- 平滑滚动
- 快速加载动画
- 操作反馈
- 错误处理和友好的错误提示
- 阅读页面点击翻页交互
- 阅读模式切换体验

#### 7.3 无障碍访问
- 语义化HTML
- 键盘导航支持
- 屏幕阅读器兼容
- 高对比度模式支持

### 8. 安全性

#### 8.1 XSS防护
- 用户输入内容过滤
- 富文本内容安全处理

#### 8.2 认证安全
- Token安全存储
- 自动过期处理

### 9. 构建和部署

#### 9.1 构建配置
- Vite配置
- 环境变量管理
- 代码分割策略

#### 9.2 部署配置
- 静态文件部署
- API接口配置
- CDN配置

## 第三方库使用

- Vue.js 3.x: 前端框架
- Vue Router: 路由管理
- Pinia: 状态管理
- Element Plus/Naive UI: UI组件库
- Axios: HTTP请求
- epub.js: EPUB格式处理
- vue-virtual-scroll-list: 长文本虚拟滚动
- vue-infinite-loading: 无限滚动加载
- js-sha256: 文件hash计算
- pinia-plugin-persistedstate: 本地存储持久化
- vue3-lazy: 图片懒加载
- vue-content-loader: 骨架屏加载
- vee-validate: 表单验证
- vue-clipboard3: 剪贴板操作
- marked: Markdown解析
- highlight.js: 代码高亮
- vue3-perfect-scrollbar: 滚动条美化
- vue-resize: 元素尺寸变化监听
- vueuse: 实用工具函数
- date-fns: 日期处理
- numeral: 数字格式化
- vue-qrcode: 二维码生成
- nprogress: 页面加载进度条
- vue-meta: SEO优化
- core-js: 兼容性垫片
- regenerator-runtime: 异步函数兼容性

## 组件设计

### 1. 基础组件
- 按钮组件
- 输入框组件
- 卡片组件
- 弹窗组件
- 加载组件

### 2. 业务组件
- 小说卡片组件
- 阅读器组件（支持txt和epub格式，使用epub.js等第三方库实现）
- 目录组件（使用第三方库实现章节导航）
- 评论组件（使用第三方库实现评论功能）
- 评分组件（支持评分、评分说明输入）
- 评分列表组件（展示评分、评分说明、点赞数）
- 评分点赞组件（对评分进行点赞）
- 搜索组件
- 翻页组件（支持点击翻页和滚动翻页，使用第三方库实现）
- 文件上传组件（支持txt、epub格式，使用vue-upload-component等第三方库实现）
- 无限滚动组件（实现滚动加载更多功能，使用vue-infinite-loading等第三方库）
- 底部导航栏组件
- 排行榜组件
- 分类选择组件（用于为小说选择分类）
- 关键词输入组件（用于为小说添加关键词）
- 小说分类设置组件（显示当前分类和关键词，允许用户设置）
- 进度条组件（显示上传进度，使用第三方库实现）
- 本地存储组件（管理阅读进度等本地数据，使用浏览器API或vuex-persist）
- 用户注册组件（邮箱注册表单，使用第三方库如vee-validate验证）
- 用户登录组件（邮箱登录表单，使用第三方库如vee-validate验证）
- 个人中心组件（展示用户信息和操作历史）
- 用户认证组件（管理JWT token和用户状态）

### 3. 布局组件
- 头部导航
- 侧边栏
- 页脚
- 响应式布局

## 第三方库使用指南

参考 `frontend_third_party_libraries.md` 文件获取详细的第三方库使用建议。

## API接口约定

### 1. 请求规范
- 使用Axios进行HTTP请求
- 统一的请求头设置
- Token自动添加

### 2. 响应处理
- 统一的响应格式处理
- 错误码处理
- 加载状态管理

### 3. 拦截器
- 请求拦截器（添加认证头等）
- 响应拦截器（错误处理、数据转换）

### 4. API响应数据结构
- 小说详情响应应包含字数统计字段
- 阅读页面需要支持翻页操作的API调用
- 上传接口支持文件和文件名一起上传

### 5. 第三方库集成
- 集成EPUB处理库（如epub.js）来处理epub格式
- 集成虚拟滚动库（如vue-virtual-scroll-list）优化长文本渲染
- 集成无限滚动库（如vue-infinite-loading）实现滚动加载更多功能
- 集成本地存储库（如vuex-persist）管理用户个性化设置
- 集成文件上传库（如vue-upload-component）处理文件上传
- 集成文本过滤库（如DOMPurify）进行内容安全处理
- 集成分页库处理无限滚动和分页请求

### 6. 特殊功能API
- 记录小说点击量：在进入小说第一章（即开始阅读）时调用后端接口记录点击量
- 排行榜接口：支持按时间范围查询排行榜数据
- 搜索接口：支持按名称、作者、主角名称、小说字数等条件搜索
- 评分接口：支持提交评分和评分说明（最多250个字符，非必填）
- 评分列表接口：获取小说的评分列表（包含评分、评分说明、点赞数、用户信息如昵称）
- 评分点赞接口：对指定评分进行点赞（需要用户登录）
- 小说分类和关键词接口：提交小说的分类和关键词（仅当用户已读完小说时）
- 搜索接口扩展：支持按分类ID和关键词搜索小说
- 章节评论接口：获取和提交小说章节评论，支持对评论进行评论
- 点赞状态管理：点赞状态通过用户ID关联服务器数据
- 用户注册登录接口：支持邮箱注册和登录
- 用户信息管理接口：支持获取和更新用户信息（如昵称）
- 小说上传接口：必须登录用户才能上传小说
- 上传小说列表接口：返回上传用户的信息（包括昵称）

## 状态管理设计

### 1. 模块划分
- 用户模块（认证状态、用户信息）
- 小说模块（列表、详情）
- 阅读模块（进度、阅读模式）
- UI模块（主题、设置）
- 分类模块（从后端获取的分类信息）
- 排行榜模块（排行榜数据、时间范围选择）

### 2. 数据流
- 组件触发动作
- Store处理逻辑
- 数据同步到组件

## 路由设计

### 1. 路由结构
- 首页 (/)
- 分类页 (/categories)
- 排行榜 (/rankings)
- 上传页 (/upload)
- 小说列表 (/novels)
- 小说详情 (/novels/:id)
- 阅读页面 (/novels/:id/read)
- 搜索页面 (/search)

### 2. 路由守卫
- 认证守卫
- 权限守卫
- 数据预加载
