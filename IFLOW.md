# 小说阅读系统项目说明

## 项目概述

本项目是一个小说阅读系统，支持多种格式的小说上传、阅读、搜索和社交功能。系统采用前后端分离架构，后端使用Go语言、Gin框架和Gorm ORM，前端使用Vue.js 3，提供类似起点中文网的阅读体验。

系统支持txt和epub格式的小说文件，具备完善的上传、审核、阅读、搜索和社交互动功能。

## 项目结构

```
web-xiaoshuo/
├── backend_requirements.md   # 后端需求文档
├── frontend_requirements.md  # 前端需求文档
├── functional_design.md      # 功能设计文档
└── IFLOW.md                  # 项目说明文档
```

## 技术栈

### 后端技术栈
- Go语言 (1.19+)
- Gin框架 (Web框架)
- Gorm (ORM框架)
- MySQL (数据库)
- Viper (配置管理)
- Logrus (日志管理)
- Godotenv (环境变量管理)
- 用于处理EPUB格式的第三方库（如golang-epub）
- 用于文件类型检测的第三方库（如filetype）
- 用于密码哈希的第三方库（如bcrypt）
- 用于HTTP请求限制的第三方库（如x/time/rate）

### 前端技术栈
- Vue.js 3.x
- Vue Router
- Pinia（状态管理）
- Composition API
- Vite（构建工具）
- Element Plus/Naive UI（UI组件库）
- TypeScript（可选）
- Axios（HTTP请求）
- 用于处理EPUB格式的第三方库（如epub.js）
- 用于虚拟滚动的第三方库（如vue-virtual-scroll-list）

## 核心功能

### 1. 小说管理功能
- 小说上传：支持txt、epub格式小说文件上传，包含文件hash验证防止重复上传
- 小说列表：展示系统中的所有小说，支持无限滚动分页
- 小说详情：显示小说基本信息、简介、字数统计、主角名称等
- 小说分类：按不同类型分类展示小说
- 阅读排行：按阅读次数排序展示小说（总榜、今日榜、本周榜、本月榜）
- 审核机制：上传后小说默认为审核中状态，可选择性过滤查看

### 2. 阅读功能
- 在线阅读：提供流畅的小说阅读体验
- 阅读进度：自动保存用户阅读进度
- 书签功能：用户可添加和管理书签
- 个性化设置：字体、背景、间距等阅读界面定制
- 阅读模式：支持滚动模式和翻页模式
- 翻页功能：点击阅读内容区域左右两侧实现翻页
- 点击量统计：在进入小说第一章（即开始阅读）时调用接口记录点击量

### 3. 搜索功能
- 小说搜索：按标题、作者、主角名称、小说字数等信息搜索小说
- 内容搜索：在小说内容中搜索关键词

### 4. 社交互动功能
- 评论系统：用户可以对小说发表评论
- 评分系统：用户可以对小说进行评分
- 心得分享：用户可以发布阅读心得

### 5. 分类管理功能
- 分类浏览：按分类浏览小说

## 界面设计

### 1. 底部导航栏
- 首页：推荐小说展示
- 分类：小说分类浏览
- 排行榜：阅读次数排行榜
- 上传：上传txt、epub格式小说

### 2. 首页
- 顶部搜索框：按名称、作者、主角名称、小说字数等搜索小说
- 推荐小说列表：展示推荐小说（名称、logo图片）
- 无限滚动加载更多小说

### 3. 分类页
- 分类列表：展示各种小说分类
- 默认显示第一个分类的小说列表（名称、logo图片）
- 无限滚动加载更多小说

### 4. 排行榜页
- 顶部时间范围选择：总榜、今日榜、本周榜、本月榜
- 排行榜列表：按点击量排序展示小说（名称、logo图片）
- 无限滚动加载更多小说

### 5. 上传页
- 上传功能：支持单个或批量上传txt、epub格式文件
- 文件hash验证：上传前计算文件hash防止重复上传
- 上传进度显示：显示上传进度条
- 审核状态：上传后小说处于审核中状态
- 小说列表：默认展示审核中和已通过的小说
- 审核过滤：可选择是否过滤审核中的小说
- 无限滚动加载更多小说

### 6. 小说详情页
- 小说封面和基本信息
- 简介和作者信息
- 小说字数统计
- 评分和评论统计
- 目录和开始阅读按钮
- 相关推荐

### 7. 阅读页
- 顶部工具栏：返回、设置、目录
- 阅读内容区域
- 设置面板：字体、主题、间距
- 目录面板：章节列表
- 阅读模式：支持滚动模式和翻页模式
- 翻页功能：点击阅读内容区域左右两侧实现翻页

## API接口设计

### 后端API主要接口

#### 小说模块
- `POST /api/v1/novels/upload` - 上传小说
- `GET /api/v1/novels` - 获取小说列表
- `GET /api/v1/novels/:id` - 获取小说详情
- `GET /api/v1/novels/:id/content` - 获取小说内容
- `POST /api/v1/novels/:id/click` - 记录小说点击量
- `GET /api/v1/search/novels` - 搜索小说

#### 分类模块
- `GET /api/v1/categories` - 获取分类列表
- `GET /api/v1/categories/:id/novels` - 获取分类下的小说

#### 排行榜模块
- `GET /api/v1/rankings` - 获取排行榜

#### 评论模块
- `POST /api/v1/comments` - 发布评论
- `GET /api/v1/comments` - 获取评论列表

#### 评分模块
- `POST /api/v1/ratings` - 评分
- `GET /api/v1/ratings/:novel_id` - 获取评分

## 数据库设计

### 主要数据表

#### 1. 小说表 (novels)
- id: 主键，自增
- title: 小说标题
- author: 作者
- protagonist: 主角名称
- description: 描述
- file_path: 文件路径
- file_size: 文件大小
- word_count: 字数统计
- click_count: 总点击量
- today_clicks: 今日点击量
- week_clicks: 本周点击量
- month_clicks: 本月点击量
- upload_time: 上传时间
- last_read_time: 最后阅读时间
- status: 小说状态 (pending-审核中, approved-已通过, rejected-已拒绝)
- file_hash: 文件hash值 (用于防止重复上传)
- created_at: 创建时间
- updated_at: 更新时间

#### 2. 分类表 (categories)
- id: 主键，自增
- name: 分类名
- description: 分类描述
- created_at: 创建时间
- updated_at: 更新时间

#### 3. 评论表 (comments)
- id: 主键，自增
- novel_id: 小说ID，外键
- chapter_id: 章节ID
- parent_id: 父评论ID，自关联
- content: 评论内容
- author_name: 评论者姓名
- like_count: 点赞数
- created_at: 创建时间
- updated_at: 更新时间

#### 4. 评分表 (ratings)
- id: 主键，自增
- novel_id: 小说ID，外键
- rating: 评分 (1-5)
- ip_address: 评分者IP地址（防重复评分）
- created_at: 创建时间
- updated_at: 更新时间

## 性能优化

### 1. 后端优化
- 数据库索引设计（对click_count、today_clicks、week_clicks、month_clicks等字段建立索引）
- 查询优化
- 连接池管理
- Redis缓存集成
- 热点数据缓存
- API响应缓存
- 排行榜数据缓存
- 字数统计缓存
- 点击量更新的异步处理

### 2. 前端优化
- 虚拟滚动（处理长文本，使用第三方库）
- 内容懒加载
- 图片懒加载
- 组件按需加载
- 翻页内容预加载
- 点击区域事件优化
- EPUB内容渲染优化
- API请求缓存
- 请求合并
- 数据压缩
- 内存泄漏防范
- 组件销毁清理
- 定时器清理

## 安全性

### 数据安全
- 防止SQL注入
- 防止XSS攻击
- 输入内容过滤和验证

### 文件安全
- 文件类型验证
- 文件大小限制
- 恶意文件检测
- 上传路径安全
- 文件hash验证（防止重复上传）

### 访问控制
- API访问频率限制
- 敏感操作验证
- 操作频率限制
- 审核权限控制

## 部署方案

- 前后端分离部署
- 数据库独立部署
- 静态资源服务
- Docker支持
- Docker Compose配置
- 多环境部署
- 健康检查接口
- 性能监控
- 错误监控

## 开发约定

### 后端开发约定
- 使用Gin框架进行路由定义
- 使用Gorm进行数据库操作
- 统一错误处理机制
- 日志记录规范
- 配置文件管理（使用Viper）
- 代码结构按功能模块划分

### 前端开发约定
- 使用Composition API
- 组件按功能模块划分
- 状态管理使用Pinia
- 路由按页面结构组织
- 统一API请求处理
- 组件命名规范
- 代码格式化规范