# 小说阅读系统启动文档

本文档详细说明如何启动和配置小说阅读系统。

## 环境要求

### 系统要求
- 操作系统: Windows 7+, macOS 10.12+, Linux (推荐 Ubuntu 18.04+)
- 内存: 4GB RAM 或更多
- 存储: 至少 2GB 可用空间

### 软件依赖
- **Go语言**: 1.24.0 或更高版本
- **Node.js**: 16.x 或更高版本
- **npm**: 8.x 或更高版本
- **MySQL**: 5.7 或更高版本
- **Redis**: 5.0 或更高版本
- **Git**: 2.x 或更高版本

## 数据库准备

### MySQL 配置
1. 安装 MySQL 数据库
2. 创建数据库:
   ```sql
   CREATE DATABASE xiaoshuo CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```
3. 创建用户并授权:
   ```sql
   CREATE USER 'xiaoshuo_user'@'localhost' IDENTIFIED BY 'Ld588588';
   GRANT ALL PRIVILEGES ON xiaoshuo.* TO 'xiaoshuo_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

### Redis 配置
1. 安装 Redis 服务
2. 确保 Redis 服务运行在默认端口 6379

## 后端启动步骤

### 1. 克隆项目
```bash
git clone <repository-url>
cd web-xiaoshuo
```

### 2. 配置后端
进入后端目录并配置:
```bash
cd xiaoshuo-backend
```

修改 `config/config.yaml` 文件中的数据库连接配置:
```yaml
database:
  host: "localhost"      # 根据实际情况修改
  port: "3306"
  user: "xiaoshuo_user"  # 根据实际情况修改
  password: "Ld588588"   # 根据实际情况修改
  dbname: "xiaoshuo"     # 根据实际情况修改
  charset: "utf8mb4"

redis:
  addr: "localhost:6379" # 根据实际情况修改
  password: ""
  db: 0
```

### 3. 安装 Go 依赖
```bash
go mod tidy
```

### 4. 启动后端服务
```bash
go run main.go
```

服务将启动在 `http://localhost:8888`

## 前端启动步骤

### 1. 进入前端目录
```bash
cd xiaoshuo-frontend
```

### 2. 安装前端依赖
```bash
npm install
```

### 3. 配置代理 (可选)
如果后端服务端口不是默认的 8888，需要修改 `vite.config.js` 中的代理配置:
```javascript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8888',  // 修改为实际后端端口
      changeOrigin: true,
      secure: false,
    },
  },
}
```

### 4. 启动前端开发服务器
```bash
npm run dev
```

前端开发服务器将启动在 `http://localhost:3000`

## 完整启动流程

### 方式一: 分别启动 (推荐开发环境)
1. 启动 Redis 服务
2. 启动 MySQL 服务
3. 在新终端中启动后端:
   ```bash
   cd xiaoshuo-backend
   go run main.go
   ```
4. 在另一个终端中启动前端:
   ```bash
   cd xiaoshuo-frontend
   npm run dev
   ```

### 方式二: 生产环境构建部署
1. 构建前端:
   ```bash
   cd xiaoshuo-frontend
   npm run build
   ```
   构建后的文件将位于 `xiaoshuo-frontend/dist/`

2. 构建后端:
   ```bash
   cd xiaoshuo-backend
   go build -o server .
   ```

3. 启动服务:
   ```bash
   ./server
   ```

## 环境变量配置

### 后端环境变量
可以通过修改 `config/config.yaml` 来配置:

- `server.port`: 服务监听端口 (默认: 8888)
- `server.mode`: 运行模式 (debug/test/release)
- `database.*`: 数据库连接配置
- `redis.*`: Redis 连接配置
- `jwt.secret`: JWT 密钥
- `jwt.expires`: JWT 过期时间(秒)

### 前端环境变量
前端使用 Vite 的环境变量机制:

创建 `.env` 文件:
```
VITE_API_BASE_URL=http://localhost:8888
```

## 常见问题解决

### 1. 端口被占用
- 检查端口占用: `netstat -an | grep :8888` (Windows) 或 `lsof -i :8888` (macOS/Linux)
- 更改配置文件中的端口号

### 2. 数据库连接失败
- 确认 MySQL 服务正在运行
- 检查 `config/config.yaml` 中的数据库配置
- 确认用户名密码正确

### 3. Redis 连接失败
- 确认 Redis 服务正在运行
- 检查 `config/config.yaml` 中的 Redis 配置

### 4. 前端无法访问后端 API
- 确认后端服务正在运行
- 检查 `vite.config.js` 中的代理配置
- 确认防火墙设置

## 服务管理

### Windows 服务管理
```bash
# 启动 MySQL
net start mysql

# 启动 Redis
redis-server --service-start

# 停止服务
net stop mysql
redis-server --service-stop
```

### Linux/macOS 服务管理
```bash
# 启动 MySQL
sudo systemctl start mysql  # Ubuntu/Debian
sudo brew services start mysql  # macOS with Homebrew

# 启动 Redis
sudo systemctl start redis  # Ubuntu/Debian
sudo brew services start redis  # macOS with Homebrew
```

## 验证安装

启动服务后，可以通过以下方式验证:

1. 访问前端页面: `http://localhost:3000`
2. 测试 API 接口: `http://localhost:8888/api/v1/ping`
3. 检查数据库连接: 确认应用日志中没有数据库连接错误

## 故障排除

### 日志查看
- 后端日志: 终端输出
- 前端日志: 浏览器控制台
- 数据库日志: MySQL 和 Redis 的日志文件

### 性能优化
- 生产环境设置 `server.mode: "release"`
- 配置数据库连接池
- 使用 CDN 加速静态资源
- 启用 Gzip 压缩

### 安全配置
- 使用 HTTPS
- 设置安全的 JWT 密钥
- 配置 CORS 策略
- 限制 API 访问频率