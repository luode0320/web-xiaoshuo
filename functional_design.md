# 小说阅读系统功能设计文档

## 项目概述

本项目是一个小说阅读系统，支持多种格式的小说上传、阅读、搜索和社交功能。系统采用前后端分离架构，提供类似起点中文网的阅读体验。系统仅支持中文。

## 核心功能

### 1. 用户管理功能
- 用户注册：使用邮箱注册，只需符合邮箱格式即可完成注册，无需邮箱验证。注册时可选择填写昵称，若未填写则默认使用邮箱作为昵称。使用第三方库如validator进行邮箱格式验证
- 用户登录：使用邮箱和密码进行登录，无需验证码。使用JWT（第三方库如github.com/golang-jwt/jwt/v4）进行认证
- 个人中心：展示用户基本信息和操作历史
- 昵称管理：用户可在个人中心修改昵称，默认昵称为登录邮箱。昵称不强制唯一，但会在显示时通过颜色或标识区分（例如：相同昵称用户头像旁边显示不同颜色的标识，或者在昵称后添加用户ID的后四位作为区分标识，使用第三方库如color-hash处理颜色生成）。
- 用户状态管理：管理员可以冻结/解冻用户账户。被冻结用户无法进行上传、评论、评分、点赞等操作，但仍可登录和阅读已有的小说内容。

  - 冻结用户功能限制：
    - 禁止操作：上传小说、发布评论、发布评分、点赞、设置小说分类和关键词
    - 允许操作：登录、阅读已有小说、查看个人中心信息
    - 阅读相关：允许更新阅读进度、记录阅读历史，但不会增加小说点击量

  - 冻结用户内容显示：
    - 内容保留：被冻结用户已发布的内容（评论、评分等）会保留在系统中
    - 冻结标识：在显示时标注"发布者已被冻结"的标签，标签样式为灰色徽章形式
    - 排序权重：冻结用户的评论和评分在排序中权重降低，不会影响热门排序
    - 界面标识：被冻结用户在界面上会显示"账户已被冻结"的水印或标识
    - 时间处理：使用第三方库如moment.js处理时间相关的显示
    - 冻结判断逻辑：当用户is_active字段为false时立即生效
    - 冻结用户内容显示样式：使用CSS类标识冻结内容，采用灰色调设计，降低视觉重要性
    - 阅读进度处理：冻结用户的阅读进度和历史记录正常保存和显示
    - 阅读权限：冻结用户仍可阅读已有小说内容，但不会增加小说点击量
    - 通知机制：向关注该用户的其他用户发送通知（可选功能）
- 未审核内容管理：管理员可以一键删除被冻结用户的未审核小说
- 管理员权限：通过is_admin字段标识管理员账户，用于执行特定管理操作。管理员权限包括：审核小说（通过/拒绝/退回修改、批量审核）、管理用户（冻结/解冻、查看用户列表）、删除内容（一键删除未审核小说、删除违规评论/评分）、查看系统统计等。

  - 操作日志管理：
    - 记录内容：管理员操作会记录到操作日志中，日志包含操作时间、操作人、操作类型、操作对象、操作结果、IP地址等详细信息
    - 查询功能：管理员可按时间范围、操作类型、操作人等条件查询操作日志
    - 导出功能：支持将操作日志导出为CSV格式
    - 存储管理：日志存储期限为1年，超过期限的日志会被自动清理
    - 使用第三方库如zap或logrus实现操作日志记录
    - 使用第三方库如gorm实现数据库日志存储

### 2. 小说管理功能
- 小说上传：支持txt、epub格式小说文件上传，文件大小限制最大20MB，包含文件hash验证防止重复上传，上传失败时提示错误信息。上传失败的错误类型包括：文件格式不支持（提示"仅支持txt和epub格式"）、文件大小超限（提示"文件大小不能超过20MB"）、文件hash重复（提示"该文件已存在"）、服务器错误（提示"上传失败，请稍后重试"）。上传成功后等待后端完成文件解析（使用第三方库如go-epub、golang-runewidth等进行字数统计、章节提取等）后再刷新列表。小说上传必须登录用户才能操作，上传的小说与上传用户关联，上传列表返回上传用户的信息（包括昵称）。用户上传的小说需要经过审核流程。

  - 章节管理：
    - 章节识别：
      - EPUB格式：使用第三方库如go-epub自动提取章节标题和结构
      - TXT格式：使用第三方库如go-regexp识别多种章节标记，包括：
        - 中文数字：/^第[一二三四五六七八九十百千万零]+[章节回].*$/（支持"第一章"、"第十章"、"第一百章"等）
        - 阿拉伯数字：/^第\d+[章节回].*$/（支持"第1章"、"第10章"等）
        - 零填充数字：/^第\d{3,4}[章节回].*$/（支持"第001章"、"第1000章"等）
        - 卷标：/^第[一二三四五六七八九十百千万零\d]+卷.*$/（支持"第一卷"、"第1卷"等）
        - 混合格式：/^第[一二三四五六七八九十百千万零\d]+[章回卷].*$/（支持"第一章第一节"等）
        - 其他格式：/^序[言章]?$|^[前引]言$|^终[章后]$|^后记$/（支持序言、引言、终章、后记等特殊章节）
      - 章节边界识别：使用第三方库如xregexp实现复杂的正则匹配和章节边界检测
      - 章节验证：使用第三方库如go-runewidth验证章节内容的完整性
    - 章节字数统计（使用第三方库如golang-runewidth）
    - 章节预览功能：
      - 截取规则：截取章节内容到超过200字符的下一个句号、问号、感叹号或段落结束
      - 实现方式：使用第三方库如go-runewidth计算字符长度，strings库处理文本截取
      - 智能截取：避免在词语中间截断，使用第三方库如go-nilan进行词边界识别
      - 语义完整性：使用第三方库如go-nlp确保截取内容的语义完整性
      - 截取优化：使用第三方库如gojieba进行中文分词，确保截取内容的语义完整性

  - 上传频率限制：
    - 每个用户每日上传小说数量限制为10本，按自然日（00:00-23:59）计算
    - 管理员用户不受此限制
    - 使用第三方库如golang.org/x/time/rate实现频率限制
    - 频次上传超过限制时提示"今日上传次数已达上限，请明天再试"

  - 文件存储路径管理：
    - 按状态分目录存放：
      - 审核中文件：存放在 pending 目录
      - 已通过文件：存放在 approved 目录  
      - 已拒绝文件：存放在 rejected 目录
    - 目录容量管理：每个目录最多存放500个小说文件，超过则新建子目录存放（如 approved/001/, approved/002/ 等）
    - 访问控制：
      - 所有小说文件访问需经过后端API验证
      - 防止直接访问文件路径
      - 验证用户权限和文件状态（例如，已拒绝的文件不允许访问）
      - 使用第三方库如net/http实现文件访问控制
    - 使用第三方库如os和path/filepath管理文件路径
    - 自动清理机制：
      - 清理规则：定期清理超过30天的临时文件和失败的上传文件
      - 清理频率：每日凌晨3点执行清理任务
      - 清理范围：包括pending目录中超过30天的未审核文件、临时上传目录中的失败文件
      - 安全机制：
        - 清理前记录日志，避免误删正在处理的文件
        - 文件锁定检测：检测文件是否被其他进程使用
        - 清理确认：对大文件或重要目录执行二次确认
        - 清理预览：提供清理预览功能，显示将要清理的文件列表
      - 实现方式：使用第三方库如gocron实现定时任务
      - 监控告警：监控存储空间使用情况，超过阈值（如80%）时发送告警
      - 清理报告：生成清理报告，记录清理的文件数量和大小
      - 存储优化：
        - 压缩存储：对长时间未访问的文件进行压缩存储
        - 分层存储：根据访问频率将文件存储在不同性能的存储介质上
        - 重复文件检测：定期检测并清理重复文件
        - 存储配额：为不同类型文件设置存储配额限制
      - 清理策略：
        - 逐步清理：避免一次性清理过多文件导致系统负载过高
        - 优先级清理：优先清理较老的临时文件
        - 峰谷清理：在系统负载较低时执行清理任务
- 小说列表：展示系统中的所有小说，支持无限滚动分页
- 小说详情：显示小说基本信息、简介、字数统计等
- 小说分类：按不同类型分类展示小说
- 阅读排行：按阅读次数排序展示小说（总榜、今日榜、本周榜、本月榜）
- 审核机制：上传后小说默认为审核中状态，可选择性过滤查看。审核人员通过管理员账户登录系统进行审核，审核标准包括格式正确性、文件完整性等。审核操作包括通过、拒绝（可选择填写原因）、退回修改（可选择填写修改意见）等。

  - 批量审核功能：
    - 支持多选操作：管理员在审核页面可通过复选框进行多选，支持Ctrl+点击选择不连续项目、Shift+点击选择连续项目
    - 操作限制：一次最多可选择50本小说，以提高审核效率
    - 批量操作类型：支持批量通过、批量拒绝、批量退回修改

  - 审核时效管理：
    - 小说在审核中状态最长保留30天
    - 使用定时任务（使用第三方库如gocron或robfig/cron）每24小时检查一次过期小说
    - 定时任务执行时间：每日凌晨2点执行
    - 超过期限未审核的小说自动转为拒绝状态并通知上传用户
  - 审核标准：
    - 格式标准：文件格式正确，能被阅读器正常解析
    - 完整性标准：文件无损坏，章节结构完整
    - 元数据标准：标题、作者等元数据完整且格式正确
    - 大小标准：文件大小在合理范围内（最小1KB，最大20MB）
    - 内容标准：无明显乱码、特殊字符等影响阅读的内容
    - 审核流程：使用第三方库如validator实现审核标准的自动化检查
    - 自动审核：
      - 格式检测：自动检测文件格式和结构
      - 元数据验证：验证标题、作者等信息的完整性
      - 内容初步检查：使用第三方库如go-runewidth检查内容编码
      - 章节检查：检测章节标题是否规范、章节顺序是否合理
      - 字数检查：确保字数在合理范围内（不少于1000字，不超过1000万字）
    - 人工审核：对自动审核通过的文件进行人工质量检查
  - 批量审核处理：
    - 批量操作错误处理：当批量审核中出现部分失败时，记录失败项并返回成功与失败的详细统计
    - 部分成功处理：成功项正常更新状态，失败项保持原状态并记录错误原因
    - 事务处理：使用数据库事务确保批量操作的一致性
    - 通知机制：批量审核完成后向上传用户发送系统消息通知
    - 批量操作限制：单次批量操作最多处理50个文件，避免长时间占用系统资源
    - 进度反馈：对大批量操作提供进度反馈，管理员可查看处理进度

  - 通知机制：
    - 审核结果会通过系统消息通知上传用户
    - 系统消息包含标题、内容、类型（通知/警告/信息）和时间戳
    - 消息永久保存但提供用户清理功能
    - 使用第三方库如gorush实现推送通知
    - 使用第三方库如gorm实现消息的数据库存储
- 分类设置：必须登录用户才能为小说设置分类和关键词。当用户阅读进度按照字数位置的百分比达到20%以上时，可以在最后一页为小说设置分类和关键词（简单判断，不需要额外验证）。分类和关键词的设置与用户ID关联，便于追踪和管理。

### 2. 阅读功能
- 在线阅读：提供流畅的小说阅读体验（使用第三方库如epub.js实现epub格式解析，支持EPUB2和EPUB3格式；使用第三方库如marked或自定义解析器实现txt格式解析）。

  - 解析失败处理：
    - 如果解析失败，系统会显示错误信息并提供原始文件下载链接
    - 解析失败的小说在阅读页面显示提示："该小说文件解析失败，您可以选择下载原始文件"
    - 提供下载按钮供用户下载原始文件
    - 无法在在线阅读器中查看内容
    - 使用第三方库如DOMPurify进行内容安全过滤
    - 前端判断解析失败的机制：通过API返回的状态码或错误信息判断
    - 后端通知前端解析失败的方式：返回特定错误码（如422 Unprocessable Entity）及详细错误信息
- 阅读进度：自动保存用户阅读进度到本地存储（使用第三方库如pinia-plugin-persistedstate实现）和服务器（使用第三方库如axios同步到后端），按照字数位置的百分比存储和展示进度，阅读进度实时更新（使用第三方库如lodash.debounce实现防抖，每30秒或翻页时更新一次），用户再次打开的时候跳转到上次位置继续阅读（使用第三方库实现章节和页码定位）。

  - 阅读统计：
    - 记录阅读时长：
      - 统计规则：仅在页面可见且用户有交互时统计，暂停超过30秒则暂停计时
      - 实现方式：使用第三方库如moment.js计算阅读时间，结合页面可见性API实现精准统计
      - 活跃度判断：结合鼠标移动、键盘输入、页面滚动等事件判断用户是否在阅读
      - 统计精度：精确到分钟，避免重复计算同一时间段
      - 累计统计：支持累计阅读时长统计，包括日、周、月、年维度
      - 会话管理：区分不同的阅读会话，准确统计每次阅读时长

    

  - 跨设备同步机制：
    - 本地存储数据仅在当前设备和浏览器中有效
    - 服务器存储支持跨设备同步
    - 同步策略：当用户在多个设备上同时阅读时，以最新的阅读进度为准进行同步；如果多个设备时间戳相同，则以进度百分比更高的为准
    - 时间戳精度：使用毫秒级时间戳进行精确比较
    - 进度精度：百分比保留两位小数（如85.25%）
    - 使用第三方库如moment.js处理时间戳比较
    - 冲突解决策略：
      - 进度冲突检测：比较时间戳和进度百分比
      - 用户选择机制：
        - 通过弹窗提示用户选择保留哪个进度
        - 使用第三方库如element-plus实现用户交互界面
        - 提供"保留本地"、"保留远程"、"合并记录"三种选择
        - 显示冲突的详细信息（时间戳、进度百分比、最后阅读章节）
      - 智能合并：自动合并阅读记录，保留完整的阅读轨迹
        - 章节合并：按章节为单位合并不同设备的阅读记录
        - 时间权重：优先保留更新时间较近的阅读进度
        - 进度比较：如时间相同则保留进度更高的记录
        - 智能算法：使用第三方库如lodash进行数据合并处理
      - 自动处理策略：
        - 提供默认处理方式，用户可设置偏好（如总是保留最新进度）
        - 可设置默认策略为"保留本地"、"保留远程"或"智能合并"
        - 自动策略可按设备或时间段设置
    - 同步失败时的处理：
      - 本地缓存进度：使用第三方库如pinia-plugin-persistedstate进行本地缓存
      - 重试机制：使用第三方库如axios实现重试机制（最多重试3次，间隔时间递增）
      - 离线支持：在网络恢复时自动同步本地缓存的进度
      - 冲突标记：标记冲突的进度记录，待用户确认后处理
      - 降级策略：同步失败时优先保证本地阅读体验，后台继续尝试同步
    - 阅读时长统计：
      - 统计规则：仅在页面可见且用户有交互时统计，暂停超过30秒则暂停计时
      - 实现方式：使用第三方库如moment.js计算阅读时间，结合页面可见性API实现精准统计
      - 活跃度判断：结合鼠标移动、键盘输入等事件判断用户是否在阅读
      - 统计精度：精确到分钟，避免重复计算同一时间段

  - 个性化设置：
    - 字体大小（范围[12-100px]，使用第三方库如vuedraggable实现拖拽调整，提供12px、14px、16px、18px、20px、24px、28px、32px常用选项）
    - 字体类型（宋体、黑体、楷体、仿宋等标准Web字体，使用第三方库如webfontloader提供字体加载，支持系统默认字体）
    - 背景颜色（白、黑、灰、护眼绿、米黄等，使用第三方库如color-thief提取护眼色，提供预设主题和自定义颜色）
    - 行间距（1.0-2.5倍，使用第三方库如css-line-height实现，预设1.2、1.5、1.8、2.0、2.5倍选项）
    - 阅读区域宽度（范围[600px-1200px]，使用第三方库如vue-resize实现宽度调整，预设适中600px、标准800px、宽屏1000px、大屏1200px选项）
    - 阅读模式：
      - 滚动模式：连续滚动阅读，适合长篇内容（使用第三方库如epubjs实现）
      - 翻页模式：模拟纸质书翻页效果，提供沉浸式阅读体验
      - 模拟翻页模式：增强版翻页效果，包含阴影、动画等视觉效果
      - 适应性阅读：根据设备类型自动调整最适合的阅读模式
    - 夜间模式：
      - 自动切换功能：根据系统时间和用户设置自动切换（使用第三方库如dayjs处理时间判断）
      - 手动切换：用户可手动开启/关闭夜间模式
      - 护眼模式：提供多种护眼主题（如护眼绿、暖色等）
      - 记忆功能：记住用户当前使用的主题模式，在下次访问时自动应用
    - 个性化配置：
      - 阅读位置记忆：记住用户当前阅读位置，包括章节和页码
      - 进度同步：跨设备同步个性化设置（使用第三方库如axios实现）
      - 配置备份：支持导出和导入个性化配置
      - 快捷键设置：支持自定义快捷键操作（如翻页、调整字体等）
    - 个性化体验优化：
      - 配置同步：使用第三方库如lodash进行配置的深拷贝和同步
      - 配置缓存：本地缓存用户配置以提升加载速度
      - 配置推荐：根据用户使用习惯推荐个性化设置
      - 配置模板：提供预设模板（如"阅读模式"、"研究模式"等）供用户选择- 阅读模式：支持滚动模式和翻页模式（通过第三方库实现）
- 翻页功能：点击阅读内容区域左侧30%实现上一页，点击右侧30%实现下页，支持覆盖翻页效果，可通过设置改成上下滚动翻页（使用第三方库实现翻页动画和流畅滚动）

### 3. 搜索功能
- 小说搜索：
  - 基础搜索：按标题、作者、主角名称、小说字数等信息搜索小说
  - 高级搜索：
    - 多条件组合搜索（使用第三方库如fuse.js实现模糊搜索，匹配度阈值设定为0.6）
    - 搜索字段权重：
      - 标题权重：1.0
      - 作者权重：0.8
      - 主角名称权重：0.7
      - 分类权重：0.6
      - 关键词权重：0.5
      - 简介权重：0.3
    - 搜索结果排序：按匹配度、点击量、评分综合排序
      - 综合评分算法：匹配度×0.4 + (点击量权重×0.25) + (评分权重×0.25) + (时间权重×0.1)
      - 时间衰减因子：对较老的结果应用时间衰减因子，优先展示较新的结果
        - 衰减公式：final_score = base_score * (1 / (1 + 0.1 * day_diff))
        - 时间权重计算：使用第三方库如moment.js计算时间衰减
    - 高级筛选：支持按分类、字数范围、评分范围等条件进行筛选
    - 搜索优化：
      - 拼音搜索：支持按拼音搜索（使用第三方库如pinyin实现）
      - 模糊匹配：支持错别字纠正和近似匹配（使用第三方库如symspell-go）
      - 搜索建议：根据用户历史和热门搜索提供智能建议
      - 搜索缓存：对常用搜索词进行缓存（使用第三方库如lru-cache）
  - 搜索历史：保存用户搜索历史（使用第三方库如localforage存储，最多保存20条记录）
    - 智能清理：自动清理重复搜索记录，保留最近的搜索
    - 快捷访问：提供快捷访问最近搜索的功能
  - 热门搜索：
    - 热门词来源：基于近7天的搜索数据统计
    - 更新频率：每小时更新一次
    - 展示数量：最多展示10个热门关键词
    - 热度计算：结合搜索频次和用户点击率计算热度值
    - 分类热门：提供分类下的热门搜索词
  - 搜索建议：
    - 触发机制：用户输入时延迟300ms触发
    - 建议数量：最多显示5条建议
    - 实现方式：使用第三方库如autosuggest-highlight
    - 数据来源：结合搜索历史和热门搜索提供智能建议
    - 智能推荐：基于用户阅读历史推荐可能感兴趣的搜索词
  - 智能搜索：支持错别字纠正（使用第三方库如symspell-go实现快速编辑距离算法）
    - 同义词扩展：搜索时自动扩展同义词，提高搜索命中率
    - 词干提取：使用第三方库如go-nlp进行词干提取，支持词汇变形搜索

### 5. 社交互动功能
- 评论系统：必须登录用户才能对小说章节进行评论，通过第三方库可以判断当前是否是每一章的最后一页，在该页面可以对小说的这一章节进行评论。前端要在每一章的最后可以提供评论的查看和用户提交评论，和对评论进行评论（支持一级回复，使用第三方库如vue3-tree-chart实现），评论用一个弹窗分页展示，弹窗中包含这一章的评论分页数据(点赞最多排序展示)，用户可以在弹窗的最下方一个输入框输入提交评论，评论的分页机制也是向下滚动刷新（使用第三方库实现，每页加载10条数据，滚动到距离底部20%时开始加载下一页）。每个用户对同一章节的评论数量限制为5条，评论内容通过前端基本验证后提交（使用第三方库如vee-validate实现字符长度、内容过滤等验证）。用户可以删除自己发布的评论，但不能编辑评论。评论发布后无需审核，立即可见。

  - 评论管理：
    - 评论排序：
      - 按时间排序：最新评论优先或最旧评论优先（使用第三方库如lodash进行数据排序处理）
      - 按点赞数排序：点赞数高的评论优先
      - 按热度排序：结合点赞数、评论时间、回复数等因子计算热度值
      - 热度算法：使用第三方库如mathjs计算热度值，公式为(点赞数+回复数*0.5)/pow((发布时间-当前时间)/1000+2, 1.8)
        - 热门评论：24小时内点赞数超过10的评论置顶显示
        - 时间权重：考虑评论的发布时间，较新的评论有一定权重优势
        - 活跃度因子：根据评论的互动情况（点赞、回复）调整权重
    - 评论限制：
      - 同章节评论数：每个用户对同一章节的评论数量限制为5条
      - 评论长度：评论内容最多500字符
      - 评论频率：同一用户连续评论间隔不少于30秒（使用第三方库如golang.org/x/time/rate实现频率限制）
    - 评论互动：
      - 评论回复：支持对评论进行回复，形成评论线程
      - 评论点赞：用户可以对评论进行点赞，但不能重复点赞


  - 删除权限：
    - 普通用户：只能删除自己发布的评论
    - 管理员：可以删除任何用户的评论，删除时需记录操作日志

同时使用第三方库如bluemonday实现HTML内容的安全过滤，防止XSS攻击。
- 评分系统：必须登录用户才能对小说进行评分，同时需要提供评分说明（用于对整个小说的评论展示，最多250个字符，非必填），评分支持点赞（登录用户限制点赞一次，点赞状态通过用户ID关联，使用第三方库如axios实现）。评分发布后无需审核，立即可见，用户不能编辑已发布的评分。评分与评论一样，一旦发布则不能修改，只能删除。使用第三方库如go-playground/validator/v10对评分内容进行基本验证。

  - 评分统计：
    - 实时计算平均分（使用第三方库如mathjs进行精确计算）
    - 评分分布统计（各星级评分数量及占比）
    - 评分趋势分析（使用第三方库如chart.js绘制评分变化趋势）
    - 评分可信度评估：
      - 用户活跃度指标：基于用户评论数、上传小说数、阅读时长等计算活跃度
      - 评分权重：
        - 活跃度高的用户评分权重更高（使用第三方库如mathjs计算加权平均分）
        - 新用户权重：对新用户评分设置较低的初始权重
        - 历史权重：考虑用户过往评分的一致性和准确性
      - 评分过滤：对异常评分（如短时间内大量评分）进行过滤
        - 评分频率检测：使用第三方库如golang.org/x/time/rate检测用户评分频率
        - 评分模式分析：分析用户评分模式，识别刷分行为
        - 评分时间间隔：检测评分时间间隔，过滤异常评分
        - 评分分布检测：检测用户评分分布是否异常（如全部给满分或最低分）
      - 评分验证：对评分内容进行质量评估，内容长度和质量作为可信度指标
      - 评分可信度计算：
        - 基础可信度：根据用户活跃度计算基础可信度（范围0-1）
        - 行为可信度：根据评分行为模式调整可信度（如评分分布是否合理）
        - 内容可信度：根据评分说明的内容质量评估可信度
        - 综合可信度：结合以上三种可信度计算综合可信度
        - 时间衰减：长期活跃用户的可信度会考虑时间衰减因子
    - 评分展示优化：
      - 加权平均分：使用可信度加权计算展示平均分
      - 评分统计：显示评分人数、评分分布等详细信息
      - 评分验证：标注高可信度评分，增加用户信任度

  - 删除权限：
    - 普通用户：只能删除自己发布的评分
    - 管理员：可以删除任何用户的评分，删除时需记录操作日志

### 4. 用户关联功能
- 用户评论：用户对小说章节的评论通过用户ID关联，便于管理和展示，评论展示时显示用户昵称
- 用户评分：用户对小说的评分通过用户ID关联，便于管理和展示，评分展示时显示用户昵称
- 用户点赞：用户对评论和评分的点赞通过用户ID关联，防止重复点赞
- 用户上传：用户上传的小说通过用户ID关联，便于管理和展示上传历史
- 用户阅读进度：用户的阅读进度通过用户ID关联，便于跨设备同步（未来扩展）

### 6. 分类管理功能
- 分类浏览：按分类浏览小说

## 界面设计

### 1. 底部导航栏
- 首页：推荐小说展示
- 分类：小说分类浏览
- 排行榜：阅读次数排行榜
- 上传：上传txt、epub格式小说
- 用户：用户个人中心、注册登录入口

### 2. 用户模块
- 用户注册：邮箱格式验证注册
- 用户登录：邮箱和密码登录
- 个人中心：展示用户基本信息、上传历史、评论历史、评分历史
- 用户内容管理：用户可在个人中心查看和管理自己上传的小说、发布的评论、提交的评分

### 8. 首页
- 顶部搜索框：按名称、作者、主角名称、小说字数等搜索小说
- 推荐小说列表：展示推荐小说（名称、logo图片）
- 无限滚动加载更多小说（使用第三方库实现，每页加载10条数据，滚动到距离底部20%时开始加载下一页，当数据加载完毕后显示"已加载全部内容"提示）

### 9. 分类页
- 分类列表：展示各种小说分类
- 默认显示第一个分类的小说列表（名称、logo图片）
- 无限滚动加载更多小说（每页加载10条数据，滚动到距离底部20%时开始加载下一页）

### 10. 排行榜页
- 顶部时间范围选择：总榜、今日榜、本周榜、本月榜
- 排行榜列表：按点击量排序展示小说（名称、logo图片）
- 无限滚动加载更多小说（每页加载10条数据，滚动到距离底部20%时开始加载下一页）

### 11. 上传页
- 上传功能：支持单个或批量上传txt、epub格式文件
- 文件hash验证：上传前计算文件hash防止重复上传
- 上传进度显示：批量上传时每上传一个进度条就前进，直到所有的都上传完成；如果是单个文件，进度条从0到100变化，上传成功后显示100的进度。上传成功后自动刷新当前页面的小说列表（使用第三方库实现）
- 审核状态：上传后小说处于审核中状态
- 小说列表：默认展示审核中和已通过的小说
- 审核过滤：可选择是否过滤审核中的小说
- 无限滚动加载更多小说（每页加载10条数据，滚动到距离底部20%时开始加载下一页）

### 12. 小说详情页
- 小说封面和基本信息
- 分类信息展示
- 关键词展示
- 简介和作者信息（部分展示）
- 评分和评论统计
- 章节目录（通过解析小说文件自动生成和上传时提供，第三方库支持，用户可点击目录项跳转到对应章节开头，当前阅读位置高亮显示。使用第三方库如epub.js或vue-router实现精确跳转）
- 快速开始阅读按钮（点击右侧区域进入第一页，当用户对当前小说的阅读进度低于10%时记录阅读次数）
- 简介弹窗（点击简介可打开详细简介弹窗，居中显示，可右上角关闭）
- 评论弹窗（点击评论可打开评论列表弹窗，居中显示，可右上角关闭，支持滚动分页，默认每页显示5条评论，支持按点赞最多和最新排序，点赞最多为默认排序）
- 相关推荐：
  - 基于内容的推荐：
    - 推荐规则：推荐拥有相同分类或者关键字的小说
    - 排序方式：按照阅读量排序的最多3本小说作为推荐
    - 无阅读量处理：默认按ID排序
    - 已读过滤：排除本地存储的已读小说
    - 展示方式：向下滚动即可看到
  - 协同过滤推荐：
    - 算法实现：使用第三方库如go-galib实现用户-物品协同过滤算法
    - 数据来源：用户评分、评论、阅读时长、阅读进度等行为数据
    - 相似度计算：
      - 用户相似度：使用余弦相似度算法计算用户相似度
      - 物品相似度：基于用户行为计算物品相似度
      - 相似度阈值：仅考虑相似度大于0.3的用户或物品
    - 推荐更新：每周更新一次用户相似度矩阵
    - 邻居选择：选择最相似的50个用户或物品作为邻居进行推荐
    - 算法优化：
      - 矩阵分解：使用SVD算法优化推荐效果（使用第三方库如gonum/matrix）
      - 冷启动处理：对新用户和新物品的特殊处理策略
      - 稀疏性处理：针对用户-物品矩阵的稀疏性进行优化
  - 热门推荐：
    - 计算方式：基于点击量、评分、评论数等综合评分推荐
    - 加权算法：点击量权重0.4、评分权重0.3、评论数权重0.2、分享数权重0.1
    - 时间衰减：对较早的数据应用时间衰减因子（使用时间衰减公式：weight = 1/(1+0.1*day_diff)）
    - 热度计算：综合考虑短期热度（近7天）和长期热度（近30天）
    - 地域因素：考虑用户所在地区偏好，提供区域性热门推荐
  - 新书推荐：
    - 时间范围：最近7天内上传且审核通过的小说
    - 质量筛选：仅推荐评分高于3星或评论数超过5条的小说
    - 推荐逻辑：按上传时间倒序排列，结合质量指标进行微调
    - 新书扶持：对优质新书给予额外推荐权重
    - 曝光平衡：确保新书有足够的曝光机会，避免被热门书籍完全覆盖
  - 个性化推荐：
    - 算法实现：根据用户阅读历史和偏好推荐，使用第三方库如go-recommend实现基于内容的推荐算法
    - 更新频率：推荐结果每日更新一次
    - 特征提取：
      - 显式特征：用户明确选择的分类、关键词、作者等
      - 隐式特征：基于阅读行为推断的偏好，如阅读时长、完成度等
      - 内容特征：小说的分类、关键词、字数、评分等属性
    - 推荐策略：结合协同过滤和基于内容的推荐，实现混合推荐算法
    - 推荐权重：协同过滤权重0.4、内容推荐权重0.3、热门推荐权重0.2、时效性权重0.1
    - 推荐多样性：确保推荐结果的多样性，避免推荐过于相似的小说
    - 冷启动问题：对新用户使用热门推荐和分类推荐解决冷启动问题
    - 推荐解释：为推荐结果提供解释（如"因为你读了《XXX》"），提高用户接受度
  - 推荐效果评估：
    - A/B测试：通过A/B测试评估不同推荐算法的效果
    - 点击率统计：统计推荐内容的点击率
    - 用户满意度：通过用户反馈评估推荐满意度
    - 推荐准确性：使用准确率、召回率等指标评估推荐准确性

### 13. 阅读页
- 顶部工具栏：返回、设置、目录
- 阅读内容区域
- 设置面板：字体、主题、间距
- 目录面板：章节列表（通过解析小说文件自动生成和上传时提供，第三方库支持）
- 阅读模式：支持滚动模式和翻页模式（通过第三方库实现）
- 翻页功能：点击阅读内容区域左侧30%实现上一页，点击右侧30%实现下页，支持覆盖翻页效果，可通过设置改成上下滚动翻页（使用第三方库实现翻页动画和流畅滚动）
- 章节评论：通过第三方库（如epub.js或txt解析库）判断当前是否是每一章的最后一页（章节边界通过正则表达式/^第[一二三四五六七八九十章回\d]+[章节回].*$/或标题样式识别，使用第三方库如xregexp实现），在该页面可以对小说的这一章节进行评论，支持在弹窗中查看和提交评论
## 交互设计

### 3. 响应式设计
- 桌面端：充分利用屏幕空间，多列布局
- 平板端：适中的内容宽度，优化触摸操作
- 手机端：单列布局，简化导航

### 4. 用户体验
- 页面加载：
  - 骨架屏或加载动画（使用第三方库如vue-content-loading实现骨架屏）
  - 预加载热门小说内容以提升用户体验
  - 渐进式加载（使用第三方库如vue-lazyload实现图片懒加载）
- 操作反馈：
  - 成功/失败提示（使用第三方库如element-plus的Notification组件）
  - 操作确认对话框（防止误操作）
  - 进度指示（上传、下载等长时间操作的进度显示）
- 错误处理：
  - 友好的错误提示（使用第三方库如vue-toastification显示错误信息）
  - 错误上报机制（使用第三方库如sentry捕获并上报错误）
  - 网络异常处理（离线模式支持和重试机制）
- 无限滚动：自动加载更多内容
- 审核状态提示：明确显示小说审核状态

## 性能要求

### 1. 前端性能
- 页面加载时间 < 3秒
- 阅读页面响应时间 < 1秒
- 大型列表的高效渲染
- EPUB格式文件的快速解析

### 2. 后端性能
- API响应时间 < 500ms
- 数据库查询优化
- 静态资源加载优化
- 文件上传处理效率

## 安全要求

### 1. 数据安全
- 防止SQL注入
- 防止XSS攻击
- 输入内容过滤和验证

### 2. 文件安全
- 文件类型验证
- 文件大小限制
- 恶意文件检测
- 文件hash验证（防止重复上传）

## 部署方案

- 前后端分离部署
- 数据库独立部署
- 静态资源服务